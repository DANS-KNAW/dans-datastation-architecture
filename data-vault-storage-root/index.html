<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Data Vault Storage Root - dans-datastation-architecture</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Data Vault Storage Root";
        var mkdocs_page_input_path = "data-vault-storage-root.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> dans-datastation-architecture
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">About</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Architecture</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../core-services/">Core Services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../datastation/">Data Station</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Configurations</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../configurations/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dataversenl/">DataverseNL</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../vaas/">Vault as a Service</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../temporary-vault-config/">Temporary Vault</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">External interfaces</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../external-interfaces/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../sword/">SWORD</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Data Vault Storage Root</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#ocfl-repositories">OCFL repositories</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#extensions">Extensions</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dataset-model-mapping">Dataset model mapping</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#versions">Versions</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#identifying-metadata">Identifying metadata</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#serialization-in-layers">Serialization in layers</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Internal interfaces</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../internal-interfaces/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../deposit-directory/">Deposit Directory</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Components</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../components/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dataverse/">Dataverse</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dans-microservices/">DANS Microservices & Tools</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dans-libraries/">DANS Libraries</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../skosmos/">Skosmos</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../nbn-resolver/">NBN Resolver (KB)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../object-store/">Object Store (SURF)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../data-archive/">Data Archive (SURF)</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Data flow</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../vault-pipeline/">Data Vault pipeline</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../dev/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../dev-common-practices/">Common practices</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../status/">Build status</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">dans-datastation-architecture</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">External interfaces</li>
      <li class="breadcrumb-item active">Data Vault Storage Root</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/DANS-KNAW/dans-datastation-architecture/edit/master/docs/data-vault-storage-root.md">Edit on DANS-KNAW/dans-datastation-architecture</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="data-vault-storage-root">Data Vault Storage Root<a class="headerlink" href="#data-vault-storage-root" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>The Data Vault is subdivided into <strong>Storage Roots</strong>, each one containing the long term preservation copies for either a Data Station or a "Vault as a
Service"  (VaaS) customer. The Data Vault Storage Root (DVSR) can be viewed as a type of interface, or exchange format, albeit an atypical one, as it is aimed
at
future users, rather than current ones.</p>
<div class="admonition alert">
<p class="admonition-title">dd-data-vault interface</p>
<p>Do not confuse the DVSR with the <a href="../dans-microservices/#dd-data-vault">service interface of dd-data-vault</a>, which is an internal microservice interface that is used by the <a href="../dans-microservices/#dd-transfer-to-vault">transfer service</a> to 
store data in the Data Vault.</p>
</div>
<h2 id="ocfl-repositories">OCFL repositories<a class="headerlink" href="#ocfl-repositories" title="Permanent link">&para;</a></h2>
<p>The DANS Data Vault is implemented as an array of <strong>OCFL</strong> repositories. OCFL stands for <a href="https://ocfl.io/" target="_blank">Oxford Common File Layout</a>. It is a community
specification for the layout of a repository that stores versioned digital objects. Each repository, or "storage root," is one
<strong>Data Vault Storage Root (DVSR)</strong>. The Data Stations each have their own DVSR as does each customer of the Vault as a Service.</p>
<h3 id="extensions">Extensions<a class="headerlink" href="#extensions" title="Permanent link">&para;</a></h3>
<p>OCFL can be extended with additional metadata and functionality. The DANS Data Vault uses the following extensions:</p>
<ul>
<li><a href="https://github.com/DANS-KNAW/dans-ocfl-extensions" target="_blank">OCFL Packaging Format extension</a> - This extension defines a way to specify for each version of an object how it is packaged.</li>
<li>Extension for supporting deletion. <strong>TODO</strong>.</li>
</ul>
<h2 id="dataset-model-mapping">Dataset model mapping<a class="headerlink" href="#dataset-model-mapping" title="Permanent link">&para;</a></h2>
<p>OCFL is a generic storage model. It does not define the concept of a dataset. The DANS archival systems (Data Stations and Vault as a Service), on the other
hand, are built around the dataset concept. The mapping between the two models is as follows:</p>
<table>
<thead>
<tr>
<th>DANS dataset model</th>
<th>OCFL model</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dataset</td>
<td>OCFL Object</td>
</tr>
<tr>
<td>Dataset Version</td>
<td>OCFL Object Version</td>
</tr>
<tr>
<td>Datafile</td>
<td>OCFL Content File</td>
</tr>
</tbody>
</table>
<h3 id="versions">Versions<a class="headerlink" href="#versions" title="Permanent link">&para;</a></h3>
<p>Each Dataset Version Export (DVE) is stored in a separate OCFL Object Version. This means that there is a 1-to-1 mapping between a DVE and an OCFL Object
Version. Note however, that it is possible that one dataset version is exported multiple times. The mapping of a dataset version to an OCFL Object is therefore
a 1-to-<em>n</em> relationship.</p>
<div class="admonition note">
<p class="admonition-title">A multiple exports scenario</p>
<p>A scenario where a dataset version is exported multiple times is when the dataset was updated in the Data Station without creating a new version. This can 
be done by a superuser and is known as <strong>"updatecurrent"</strong>. A new Dataset Version Export will be created and therefore a new OCFL Object Version will be 
created as well. The Data Station version history, however, will <strong>not</strong> display an additional version.</p>
</div>
<h3 id="identifying-metadata">Identifying metadata<a class="headerlink" href="#identifying-metadata" title="Permanent link">&para;</a></h3>
<p>To identify datasets, versions and data files in the OCFL repository, the following metadata is used:</p>
<p><img alt="Vault metadata" class="align-center" src="../vault-metadata.png" /></p>
<p>The full metadata of each dataset version is stored, but the way it is stored depends on the packaging format used. The current packaging format is based on
Dataverse implementation of <a href="http://doi.org/10.15497/RDA00025" target="_blank">RDA BagPack</a>.</p>
<h2 id="serialization-in-layers">Serialization in layers<a class="headerlink" href="#serialization-in-layers" title="Permanent link">&para;</a></h2>
<p>OCFL repositories can be serialized in different ways, for example as a directory structure on a file system, or as objects in an object store. The DANS Data
Vault uses the SURF <a href="https://www.surf.nl/en/services/data-archive" target="_blank">Data Archive</a> tape storage. The tape storage system that is used by Data Archive organizes files in a file-folder
structure, so in principle serialization should be the same as to a disk-based files system, from OCFL's perspective. However, the tape storage system requires
a minimum file size of 1GB, which is much larger than the typical data file stored in the DANS Data Vault. To meet this requirement, the OCFL repositories are
stored as a series of DMFTAR archives, each of which is larger than 1GB. Each archive forms a layer. For a more detailed description of the layers, see the
documentation of <a href="../dans-libraries/#dans-layer-store-lib" target="_blank">dans-layer-store-lib</a>.</p>
<p>To restore the OCFL repository, the layers must be extracted in the correct order. SURF provides a utility called <a href="https://servicedesk.surf.nl/wiki/display/WIKI/Data+Archive%3A+Packaging+with+dmftar" target="_blank">dmftar</a> to create and extract
DMFTAR archives. This utility is the interface to the tape storage system.</p>
<div class="admonition alert">
<p class="admonition-title">Restoring without the <code>dmftar</code> utility</p>
<p>Even without the <code>dmftar</code> utility, it is possible to restore the OCFL repository, as long as the layers are extracted in the correct order. A DMFTAR archive 
is just a lightweight wrapper around a TAR archive, implemented as a directory containing batches of (possibly multi-volume) TAR files along with index 
files and a checksum file.</p>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../sword/" class="btn btn-neutral float-left" title="SWORD"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../internal-interfaces/" class="btn btn-neutral float-right" title="Overview">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/DANS-KNAW/dans-datastation-architecture" class="fa fa-code-fork" style="color: #fcfcfc"> DANS-KNAW/dans-datastation-architecture</a>
        </span>
    
    
      <span><a href="../sword/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../internal-interfaces/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox-plus-jquery.min.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
